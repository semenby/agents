{"version":3,"file":"content.mjs","sources":["../../../src/messages/content.ts"],"sourcesContent":["import { ContentTypes } from '@/common';\nimport type { BaseMessage } from '@langchain/core/messages';\n\n/**\n * Formats an array of messages for LangChain, making sure all content fields are strings\n * @param {Array<HumanMessage | AIMessage | SystemMessage | ToolMessage>} payload - The array of messages to format.\n * @returns {Array<HumanMessage | AIMessage | SystemMessage | ToolMessage>} - The array of formatted LangChain messages, including ToolMessages for tool calls.\n */\nexport const formatContentStrings = (\n  payload: Array<BaseMessage>\n): Array<BaseMessage> => {\n  // Create a new array to store the processed messages\n  const result: Array<BaseMessage> = [];\n\n  for (const message of payload) {\n    const messageType = message.getType();\n    const isValidMessage =\n      messageType === 'human' ||\n      messageType === 'ai' ||\n      messageType === 'system';\n\n    if (!isValidMessage) {\n      result.push(message);\n      continue;\n    }\n\n    // If content is already a string, add as-is\n    if (typeof message.content === 'string') {\n      result.push(message);\n      continue;\n    }\n\n    // If content is not an array, add as-is\n    if (!Array.isArray(message.content)) {\n      result.push(message);\n      continue;\n    }\n\n    // Check if all content blocks are text type\n    const allTextBlocks = message.content.every(\n      (block) => block.type === ContentTypes.TEXT\n    );\n\n    // Only convert to string if all blocks are text type\n    if (!allTextBlocks) {\n      result.push(message);\n      continue;\n    }\n\n    // Reduce text types to a single string\n    const content = message.content.reduce((acc, curr) => {\n      if (curr.type === ContentTypes.TEXT) {\n        return `${acc}${curr[ContentTypes.TEXT] || ''}\\n`;\n      }\n      return acc;\n    }, '');\n\n    message.content = content.trim();\n    result.push(message);\n  }\n\n  return result;\n};\n"],"names":[],"mappings":";;AAGA;;;;AAIG;AACU,MAAA,oBAAoB,GAAG,CAClC,OAA2B,KACL;;IAEtB,MAAM,MAAM,GAAuB,EAAE;AAErC,IAAA,KAAK,MAAM,OAAO,IAAI,OAAO,EAAE;AAC7B,QAAA,MAAM,WAAW,GAAG,OAAO,CAAC,OAAO,EAAE;AACrC,QAAA,MAAM,cAAc,GAClB,WAAW,KAAK,OAAO;AACvB,YAAA,WAAW,KAAK,IAAI;YACpB,WAAW,KAAK,QAAQ;QAE1B,IAAI,CAAC,cAAc,EAAE;AACnB,YAAA,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACpB;;;AAIF,QAAA,IAAI,OAAO,OAAO,CAAC,OAAO,KAAK,QAAQ,EAAE;AACvC,YAAA,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACpB;;;QAIF,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE;AACnC,YAAA,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACpB;;;QAIF,MAAM,aAAa,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,CACzC,CAAC,KAAK,KAAK,KAAK,CAAC,IAAI,KAAK,YAAY,CAAC,IAAI,CAC5C;;QAGD,IAAI,CAAC,aAAa,EAAE;AAClB,YAAA,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YACpB;;;AAIF,QAAA,MAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,KAAI;YACnD,IAAI,IAAI,CAAC,IAAI,KAAK,YAAY,CAAC,IAAI,EAAE;AACnC,gBAAA,OAAO,CAAG,EAAA,GAAG,CAAG,EAAA,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,CAAA,EAAA,CAAI;;AAEnD,YAAA,OAAO,GAAG;SACX,EAAE,EAAE,CAAC;AAEN,QAAA,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,IAAI,EAAE;AAChC,QAAA,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;;AAGtB,IAAA,OAAO,MAAM;AACf;;;;"}