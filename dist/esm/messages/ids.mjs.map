{"version":3,"file":"ids.mjs","sources":["../../../src/messages/ids.ts"],"sourcesContent":["// src/stream.ts\nimport { nanoid } from 'nanoid';\nimport type { Graph } from '@/graphs';\nimport type * as t from '@/types';\n\nexport const getMessageId = (\n  stepKey: string,\n  graph: Graph<t.BaseGraphState>,\n  returnExistingId = false\n): string | undefined => {\n  const messageId = graph.messageIdsByStepKey.get(stepKey);\n  if (messageId != null && messageId) {\n    return returnExistingId ? messageId : undefined;\n  }\n\n  const prelimMessageId = graph.prelimMessageIdsByStepKey.get(stepKey);\n  if (prelimMessageId != null && prelimMessageId) {\n    graph.prelimMessageIdsByStepKey.delete(stepKey);\n    graph.messageIdsByStepKey.set(stepKey, prelimMessageId);\n    return prelimMessageId;\n  }\n\n  const message_id = `msg_${nanoid()}`;\n  graph.messageIdsByStepKey.set(stepKey, message_id);\n  return message_id;\n};\n"],"names":[],"mappings":";;AAAA;AAKO,MAAM,YAAY,GAAG,CAC1B,OAAe,EACf,KAA8B,EAC9B,gBAAgB,GAAG,KAAK,KACF;IACtB,MAAM,SAAS,GAAG,KAAK,CAAC,mBAAmB,CAAC,GAAG,CAAC,OAAO,CAAC;AACxD,IAAA,IAAI,SAAS,IAAI,IAAI,IAAI,SAAS,EAAE;QAClC,OAAO,gBAAgB,GAAG,SAAS,GAAG,SAAS;;IAGjD,MAAM,eAAe,GAAG,KAAK,CAAC,yBAAyB,CAAC,GAAG,CAAC,OAAO,CAAC;AACpE,IAAA,IAAI,eAAe,IAAI,IAAI,IAAI,eAAe,EAAE;AAC9C,QAAA,KAAK,CAAC,yBAAyB,CAAC,MAAM,CAAC,OAAO,CAAC;QAC/C,KAAK,CAAC,mBAAmB,CAAC,GAAG,CAAC,OAAO,EAAE,eAAe,CAAC;AACvD,QAAA,OAAO,eAAe;;AAGxB,IAAA,MAAM,UAAU,GAAG,CAAA,IAAA,EAAO,MAAM,EAAE,EAAE;IACpC,KAAK,CAAC,mBAAmB,CAAC,GAAG,CAAC,OAAO,EAAE,UAAU,CAAC;AAClD,IAAA,OAAO,UAAU;AACnB;;;;"}